apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: nanoaod-argo-
spec:
  entrypoint: parallel-worker

  podGC:
    # pod gc strategy must be one of the following
    # * OnPodCompletion - delete pods immediately when pod is completed (including errors/failures)
    # * OnPodSuccess - delete pods immediately when pod is successful
    # * OnWorkflowCompletion - delete pods when workflow is completed
    # * OnWorkflowSuccess - delete pods when workflow is successful
    strategy: OnPodSuccess

  volumes:
  - name: task-pv-storage
    persistentVolumeClaim:
      claimName: nfs-1

  templates:
  - name: nanoaod-argo
    inputs:
      parameters:
      - name: files
      - name: it
    script:
      image: cmsopendata/cmssw_5_3_32
      command: [sh]
      source: |
        source /opt/cms/entrypoint.sh
        sudo chown $USER /mnt/vol
        mkdir workspace
        cd workspace
        git clone git://github.com/cms-opendata-analyses/AOD2NanoAODOutreachTool  AOD2NanoAOD
        cd AOD2NanoAOD
        scram b -j8
        varfiles="{{inputs.parameters.files}}"
        sed -i "s,CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_10000_file_index.txt,$varfiles,g" configs/data_cfg.py
        sed -i 's,files.extend,#files.extend,g' configs/data_cfg.py
        cmsRun configs/data_cfg.py
        iterator="{{inputs.parameters.it}}"
        cp output.root /mnt/vol/output$iterator.root
        echo  ls -l /mnt/vol
        ls -l /mnt/vol
      volumeMounts:
      - name: task-pv-storage
        mountPath: /mnt/vol

  - name: parallel-worker
    dag:
      tasks:
      - name: 1
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleElectron_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 1}]
      - name: 2
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleElectron_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 2}]
      - name: 3
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleElectron_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 3}]
      - name: 4
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_10000_file_index.txt}, {name: it, value: 4}]
      - name: 5
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 5}]
      - name: 6
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 6}]
      - name: 7
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_20002_file_index.txt}, {name: it, value: 7}]
      - name: 8
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 8}]
      - name: 9
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_210000_file_index.txt}, {name: it, value: 9}]
      - name: 10
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_DoubleMuParked_AOD_22Jan2013-v1_310000_file_index.txt}, {name: it, value: 10}]
      - name: 11
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 11}]
      - name: 12
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 12}]
      - name: 13
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20002_file_index.txt}, {name: it, value: 13}]
      - name: 14
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20003_file_index.txt}, {name: it, value: 14}]
      - name: 15
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20008_file_index.txt}, {name: it, value: 15}]
      - name: 16
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20009_file_index.txt}, {name: it, value: 16}]
      - name: 17
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20011_file_index.txt}, {name: it, value: 17}]
      - name: 18
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20012_file_index.txt}, {name: it, value: 18}]
      - name: 19
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20014_file_index.txt}, {name: it, value: 19}]
      - name: 20
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20016_file_index.txt}, {name: it, value: 20}]
      - name: 21
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20020_file_index.txt}, {name: it, value: 21}]
      - name: 22
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20023_file_index.txt}, {name: it, value: 22}]
      - name: 23
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20025_file_index.txt}, {name: it, value: 23}]
      - name: 24
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20033_file_index.txt}, {name: it, value: 24}]
      - name: 25
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20036_file_index.txt}, {name: it, value: 25}]
      - name: 26
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_20040_file_index.txt}, {name: it, value: 26}]
      - name: 27
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 27}]
      - name: 28
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_30001_file_index.txt}, {name: it, value: 28}]
      - name: 29
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_30003_file_index.txt}, {name: it, value: 29}]
      - name: 30
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_30004_file_index.txt}, {name: it, value: 30}]
      - name: 31
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_SingleMu_AOD_22Jan2013-v1_110000_file_index.txt}, {name: it, value: 31}]
      - name: 32
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 32}]
      - name: 33
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 33}]
      - name: 34
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30001_file_index.txt}, {name: it, value: 34}]
      - name: 35
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30002_file_index.txt}, {name: it, value: 35}]
      - name: 36
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30004_file_index.txt}, {name: it, value: 36}]
      - name: 37
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30005_file_index.txt}, {name: it, value: 37}]
      - name: 38
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30010_file_index.txt}, {name: it, value: 38}]
      - name: 39
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012B_TauPlusX_AOD_22Jan2013-v1_30020_file_index.txt}, {name: it, value: 39}]
      - name: 40
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleElectron_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 40}]
      - name: 41
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleElectron_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 41}]
      - name: 42
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleElectron_AOD_22Jan2013-v1_20002_file_index.txt}, {name: it, value: 42}]
      - name: 43
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleElectron_AOD_22Jan2013-v1_20003_file_index.txt}, {name: it, value: 43}]
      - name: 44
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleElectron_AOD_22Jan2013-v1_20011_file_index.txt}, {name: it, value: 44}]
      - name: 45
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10000_file_index.txt}, {name: it, value: 45}]
      - name: 46
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10001_file_index.txt}, {name: it, value: 46}]
      - name: 47
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10002_file_index.txt}, {name: it, value: 47}]
      - name: 48
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10003_file_index.txt}, {name: it, value: 48}]
      - name: 49
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10010_file_index.txt}, {name: it, value: 49}]
      - name: 50
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10011_file_index.txt}, {name: it, value: 50}]
      - name: 51
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10013_file_index.txt}, {name: it, value: 51}]
      - name: 52
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10016_file_index.txt}, {name: it, value: 52}]
      - name: 53
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10018_file_index.txt}, {name: it, value: 53}]
      - name: 54
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10021_file_index.txt}, {name: it, value: 54}]
      - name: 55
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10022_file_index.txt}, {name: it, value: 55}]
      - name: 56
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_10024_file_index.txt}, {name: it, value: 56}]
      - name: 57
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_DoubleMuParked_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 57}]
      - name: 58
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 58}]
      - name: 59
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 59}]
      - name: 60
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20002_file_index.txt}, {name: it, value: 60}]
      - name: 61
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20003_file_index.txt}, {name: it, value: 61}]
      - name: 62
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20004_file_index.txt}, {name: it, value: 62}]
      - name: 63
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20005_file_index.txt}, {name: it, value: 63}]
      - name: 64
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20006_file_index.txt}, {name: it, value: 64}]
      - name: 65
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20008_file_index.txt}, {name: it, value: 65}]
      - name: 66
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20017_file_index.txt}, {name: it, value: 66}]
      - name: 67
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20018_file_index.txt}, {name: it, value: 67}]
      - name: 68
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20021_file_index.txt}, {name: it, value: 68}]
      - name: 69
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20030_file_index.txt}, {name: it, value: 69}]
      - name: 70
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20040_file_index.txt}, {name: it, value: 70}]
      - name: 71
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20045_file_index.txt}, {name: it, value: 71}]
      - name: 72
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20046_file_index.txt}, {name: it, value: 72}]
      - name: 73
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20048_file_index.txt}, {name: it, value: 73}]
      - name: 74
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20055_file_index.txt}, {name: it, value: 74}]
      - name: 75
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20058_file_index.txt}, {name: it, value: 75}]
      - name: 76
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_20059_file_index.txt}, {name: it, value: 76}]
      - name: 77
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 77}]
      - name: 78
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_30004_file_index.txt}, {name: it, value: 78}]
      - name: 79
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_30007_file_index.txt}, {name: it, value: 79}]
      - name: 80
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_30008_file_index.txt}, {name: it, value: 80}]
      - name: 81
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_SingleMu_AOD_22Jan2013-v1_30010_file_index.txt}, {name: it, value: 81}]
      - name: 82
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_20000_file_index.txt}, {name: it, value: 82}]
      - name: 83
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_20001_file_index.txt}, {name: it, value: 83}]
      - name: 84
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_20004_file_index.txt}, {name: it, value: 84}]
      - name: 85
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30000_file_index.txt}, {name: it, value: 85}]
      - name: 86
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30001_file_index.txt}, {name: it, value: 86}]
      - name: 87
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30002_file_index.txt}, {name: it, value: 87}]
      - name: 88
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30004_file_index.txt}, {name: it, value: 88}]
      - name: 89
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30008_file_index.txt}, {name: it, value: 89}]
      - name: 90
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30022_file_index.txt}, {name: it, value: 90}]
      - name: 91
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_30026_file_index.txt}, {name: it, value: 91}]
      - name: 92
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_210000_file_index.txt}, {name: it, value: 92}]
      - name: 93
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_210001_file_index.txt}, {name: it, value: 93}]
      - name: 94
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_310000_file_index.txt}, {name: it, value: 94}]
      - name: 95
        template: nanoaod-argo
        arguments:
          parameters: [{name: files, value: CMS_Run2012C_TauPlusX_AOD_22Jan2013-v1_310001_file_index.txt}, {name: it, value: 95}]
